# 📊 学生成绩汇总工具

> 一个智能、高效的学生成绩数据处理工具，支持自动识别Excel文件格式，智能提取学生信息，一键生成完整成绩汇总表。

## ✨ 核心特性

### 🔧 智能兼容
- **多格式支持**：完美兼容 `.xls` 和 `.xlsx` 格式
- **智能引擎**：自动选择最佳的Excel读取引擎（openpyxl/xlrd）
- **容错处理**：单个文件错误不影响整体处理流程

### 📈 数据处理
- **智能表头识别**：自动识别各种表格格式的学号、姓名、班级等列
- **精确学号定位**：先定位表头，再范围搜索，避免误识别
- **多类型成绩汇总**：支持SA（作业）、LA（实验）、TL（讨论）成绩

### 📊 统计分析
- **数据完整性检查**：自动检测空值、异常值
- **详细统计报告**：学生分布、性别统计、成绩覆盖率
- **可视化输出**：清晰的表格预览和数据统计

## 🚀 快速开始

### 1. 环境准备

```bash
# 安装必要依赖
pip install pandas openpyxl xlrd xlwt
```

### 2. 生成示例数据

```bash
# 创建示例Excel文件用于测试
python create_examples.py
```

### 3. 运行成绩汇总

```bash
# 自动处理当前目录下的所有Excel文件
python grade_summary_tool.py
```

## 📁 文件组织

### 支持的文件命名格式

```
工作目录/
├── CL_Example.xls     # 班级名单（学生基本信息）
├── SA_Example.xls     # 作业成绩
├── LA_Example.xls     # 实验成绩  
├── TL_Example.xlsx    # 讨论成绩
└── 学生成绩汇总表.xlsx # 自动生成的汇总结果
```

### 文件内容要求

| 文件类型 | 必需列 | 可选列 | 说明 |
|---------|--------|--------|------|
| **CL文件** | 学号、姓名 | 序号、班级、性别、专业 | 学生基本信息 |
| **SA文件** | 学号、得分 | 作业标题、提交时间 | 作业成绩 |
| **LA文件** | 学号、得分 | 实验名称、实验时间 | 实验成绩 |
| **TL文件** | 学号、讨论/ | 讨论主题、参与度 | 讨论成绩 |

## 💡 使用示例

### 基础用法

```python
from grade_summary_tool import create_grade_summary, export_summary_with_stats

# 处理当前目录的文件
summary_df = create_grade_summary()

# 导出结果并显示统计
export_summary_with_stats(summary_df)
```

### 自定义目录

```python
# 指定数据目录
summary_df = create_grade_summary(data_directory='./data')

# 自定义输出文件名
export_summary_with_stats(summary_df, output_filename="2024年成绩汇总.xlsx")
```

## 🔍 核心算法

### 智能学号识别
```python
# 1. 表头定位：在前20行搜索"学号"关键字
# 2. 范围搜索：从表头向下搜索30行
# 3. 格式验证：长度≥8、包含数字、非纯数字
# 4. 多格式支持：U202xxx、S202xxx、BJ202xxx等
```

### 文件读取策略
```python
# 智能引擎选择
engines = ['openpyxl', 'xlrd'] if file.endswith('.xls') else ['openpyxl']
for engine in engines:
    try:
        df = pd.read_excel(file, engine=engine)
        break
    except Exception:
        continue  # 尝试下一个引擎
```

## 📊 输出说明

### 汇总表结构

| 列名 | 类型 | 说明 |
|------|------|------|
| 序号 | 整数 | 重新编排的连续序号 |
| 原序号 | 字符串 | CL文件中的原始序号 |
| 学号 | 字符串 | 学生学号（主键） |
| 姓名 | 字符串 | 学生姓名 |
| 班级 | 字符串 | 学生所在班级 |
| 性别 | 字符串 | 男/女 |
| 来源文件 | 字符串 | 数据来源的CL文件名 |
| SA_* | 数值 | 作业成绩（动态列） |
| LA_* | 数值 | 实验成绩（动态列） |
| TL讨论 | 数值 | 讨论成绩 |

### 运行输出示例

```
=== 学生成绩汇总工具 ===
开始执行成绩汇总...
发现 4 个数据文件:
  1. CL_Example.xls
  2. SA_Example.xls  
  3. LA_Example.xls
  4. TL_Example.xlsx

第一步：从CL文件提取学生信息...
   处理 CL_Example.xls...
     找到表头行: 第1行，包含列: ['序号', '学号', '姓名', '班级', '性别']
     找到学生: U202001001 张三 (原序号:1, 班级:计算机科学与技术, 性别:男)
     ...
   共找到 10 名学生

第二步：收集SA表得分...
   收集到 10 名学生的SA成绩

第三步：收集LA表得分...  
   收集到 10 名学生的LA成绩

第四步：收集TL表讨论成绩...
   收集到 10 名学生的TL讨论成绩

=== 成绩汇总结果 ===
汇总表包含 10 名学生的成绩
前5名学生的成绩预览:
 序号 原序号      学号    姓名    班级    性别  SA_Example  LA_Example  TL讨论
   1    1  U202001001  张三  计算机科学与技术   男         85          85      88
   2    2  U202001002  李四  计算机科学与技术   女         92          92      92
   ...

成绩汇总表已导出至: 学生成绩汇总表.xlsx
```

## 🛠️ 高级功能

### 数据质量检查
- **完整性统计**：各项成绩的覆盖率分析
- **异常值检测**：超出合理范围的成绩提醒
- **重复数据检查**：相同学号的重复记录提醒

### 容错机制  
- **文件格式兼容**：自动处理.xls/.xlsx混合情况
- **编码自适应**：自动识别文件编码
- **部分数据处理**：即使部分文件有问题也能生成汇总

### 性能优化
- **范围搜索**：限制搜索范围提升处理速度
- **内存管理**：大文件分批处理避免内存溢出
- **缓存机制**：重复处理时复用已解析的数据

## ❓ 常见问题

### Q: 为什么某些学生成绩显示为0？
**A**: 该学生在对应成绩文件中没有记录，系统自动填充0保持数据完整性。

### Q: 支持什么样的学号格式？
**A**: 支持长度≥8字符、包含数字的各种格式，如：U202001001、S202001006、BJ202001008等。

### Q: 如何处理文件格式兼容性问题？
**A**: 工具自动检测文件格式并选择合适的读取引擎，无需手动配置。

### Q: 表头不在第一行怎么办？
**A**: 工具会在前20行自动搜索表头，支持各种表格格式。

## 🔧 技术栈

- **Python 3.7+** - 核心运行环境
- **pandas** - 数据处理和分析
- **openpyxl** - 现代Excel文件处理
- **xlrd/xlwt** - 传统Excel格式支持

## 📝 更新日志

### v2.0 - 最新版本
- ✅ 完全兼容.xls格式文件
- ✅ 智能引擎选择机制
- ✅ 增强的容错处理
- ✅ 改进的数据统计报告

### v1.0 - 初始版本  
- ✅ 基础成绩汇总功能
- ✅ 多文件自动发现
- ✅ Excel格式导出

## 📄 许可证

MIT License - 自由使用、修改和分发

## 👨‍💻 作者

**Chaoan** 

---

> 💡 **提示**: 本工具专为教育管理设计，请确保遵守相关数据隐私法规。如有问题或建议，欢迎提交Issue！ 